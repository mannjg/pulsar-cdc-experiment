tenant: "public"
namespace: "default"
name: "debezium-postgres-source"
topicName: "persistent://public/default/dbserver1.public.customers"
archive: "builtin://debezium-postgres"
parallelism: 1

configs:
  # Debezium connector class
  connector.class: "io.debezium.connector.postgresql.PostgresConnector"

  # Database connection
  database.hostname: "postgres.pulsar.svc.cluster.local"
  database.port: "5432"
  database.user: "postgres"
  database.password: "postgres"
  database.dbname: "inventory"
  database.server.name: "dbserver1"

  # Topic prefix (required in Pulsar 4.1.2 / Debezium 3.2+)
  topic.prefix: "dbserver1"

  # Schema and table filtering
  table.include.list: "public.customers"

  # Replication slot configuration
  slot.name: "debezium"
  plugin.name: "pgoutput"

  # Offset storage (using Pulsar for offset tracking)
  offset.storage: "org.apache.kafka.connect.storage.MemoryOffsetBackingStore"

  # Snapshot mode
  snapshot.mode: "initial"

  # Publication configuration
  publication.autocreate.mode: "all_tables"

  # Schema change handling
  schema.history.internal.skip.unparseable.ddl: "true"

  # Time precision
  time.precision.mode: "adaptive_time_microseconds"

  # Decimal handling
  decimal.handling.mode: "double"

  # Schema configuration
  # json-with-envelope forces Schema.BYTES for both key and value schemas
  # This prevents the BYTES -> JSON schema incompatibility that occurs when:
  # - Snapshot mode (0 records) creates topic with BYTES schema
  # - Streaming mode (real CDC events) tries to register JSON schemas
  # Reference: KafkaConnectSource.java lines 134-149
  json-with-envelope: "true"

# Kubernetes runtime configuration for StatefulSet deployment
customRuntimeOptions: |
  {
    "clusterName": "pulsar",
    "jobNamespace": "pulsar",
    "extractLabels": {
      "app": "debezium-postgres-source",
      "component": "source-connector"
    },
    "statefulSetName": "debezium-postgres-source"
  }

# Resource specifications
resources:
  requests:
    cpu: "0.5"
    memory: "1Gi"
  limits:
    cpu: "1"
    memory: "2Gi"
